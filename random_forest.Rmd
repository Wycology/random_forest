---
title: "<center>Using `randomForest` in R</center>"
author: "<center>Wyclife Agumba Oluoch</center>"
date: "<center>`r Sys.time()`</center>"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libs, echo=FALSE, warning=FALSE, message=FALSE, include=FALSE}
packages <- c("base",
              'knitr',
              'rmarkdown',
              'prettydoc',
              'randomForest',
              'datasets',
              'caret')
installed_packages <- packages %in% rownames(installed.packages())
if(any(installed_packages == FALSE)){
  install.packages(packages[!installed_packages])
}
lapply(packages, library, character.only = TRUE) |> invisible()
```

```{r write_bib, echo=FALSE, warning=FALSE, message=FALSE, include=FALSE}
knitr::write_bib(c(
  .packages(), packages
), 'bib/packages.bib')
```

# Introduction

This work was developed following this [blog](https://www.r-bloggers.com/2021/04/random-forest-in-r/#:~:text=Random%20Forest%20in%20R%2C%20Random,to%20identify%20the%20important%20attributes.)

Here I demonstrate how to use `randomForest` in R to train a model and make prediction over new data.

We will use the inbuilt iris data for this demonstration. In that case, we use the four continuous variables to predict species of iris flower.

```{r}
data <- iris
str(data) # Checking for the structure of the data
```

Converting Species variable to factor since initially it was seen as character.

```{r}
data$Species <- as.factor(data$Species)
table(data$Species)
```


Partitioning the data into train and test sets.

```{r}
set.seed(222)
ind <- sample(2, nrow(data), replace = TRUE, prob = c(0.7, 0.3))
train <- data[ind == 1,]
test <- data[ind == 2,]
```

Building the random forest model using the target and all the continuous variables in the dataset.

```{r}
rf <- randomForest(Species ~., data = train, proximity = TRUE)
print(rf)
```

Predicting on train data

```{r}
predict_train <- predict(rf, train)
confusionMatrix(predict_train, train$Species)
```

Predicting on test data

```{r}
predict_test <- predict(rf, test)
confusionMatrix(predict_test, test$Species)
```

 Error rate of the model
 
```{r}
plot(rf, main = "Plot of the randomForest model")
```


Tuning the model, although it already performed well

```{r}
t <- tuneRF(train[, -5], train[, 5],
            stepFactor = 0.5,
            plot = TRUE,
            ntreeTry = 150,
            trace = TRUE,
            improve = 0.05)
```


```{r}
hist(treesize(rf),
     main = 'No. of nodes for the trees',
     col = 'green')

varImpPlot(rf, 
           sort = TRUE,
           n.var = 10,
           main = 'Top 10 variable importance')

importance(rf)
```


Partial dependence plot
```{r}
partialPlot(rf, train, Petal.Width, 'setosa')
```

Multi-dimensional plot

```{r}
MDSplot(rf, train$Species, pch = 10)
```















